function initWebsocket(){ws=new WebSocket("ws://"+window.location.host+"/ws");try{ws.onmessage=onMessage,ws.onopen=function(){for(i=0;MODULES.length>i;i++)MODULES[i]!=null&&MODULES[i].onConnect!=void 0&&MODULES[i].onConnect();sendMessage(-1,"changePage",PAGE),sendMessage(-1,"changeLayout",LAYOUT.id)},ws.onerror=function(){console.error("There was an un-identified Web Socket error")},ws.onclose=showOfflineOverlay}catch(e){console.error('Sorry, the web socket at "%s" is un-available error',WS_ADDRESS),console.log(e)}}function initFullScreenWebsocket(){ws=new WebSocket("ws://"+window.location.host+"/ws-full-screen");try{ws.onmessage=onFullScreenMessage,ws.onopen=function(){MODULE.onConnect(),MODULE.documentReady("full-screen"),sendMessage(MODULE.moduleId,"setModule","")},ws.onerror=function(){console.error("There was an un-identified Web Socket error")},ws.onclose=showOfflineOverlay}catch(e){console.error('Sorry, the web socket at "%s" is un-available error',WS_ADDRESS),console.log(e)}}function onMessage(e){var o=JSON.parse(e.data);switch(console.log(e.data),o.command){case"success":showSuccessMessage(o.message);break;case"error":showErrorMessage(o.message);break;case"reload":location.reload();break;case"remote404":$("#"+o.id+"-overlay").html("This remote module is not available at the moment."),$("#"+o.id+"-overlay").show();break;default:$("#"+o.id+"-overlay").hide()}var s=$('.gridster .module[data-module="'+o.id+'"]').attr("data-size");MODULES[o.id]["onMessage_"+s](o.command,o.message,o.extra)}function onFullScreenMessage(e){var o=JSON.parse(e.data);switch(console.log(e.data),o.command){case"success":showSuccessMessage(o.message);break;case"error":showErrorMessage(o.message);break;case"reload":location.reload();break;case"remote404":$("#"+o.id+"-overlay").html("This remote module is not available at the moment."),$("#"+o.id+"-overlay").show();break;default:$("#"+o.id+"-overlay").hide()}MODULE.onMessage_fullScreen(o.command,o.message,o.extra)}function showOfflineOverlay(){$("#overlay").addClass("showing")}function showSuccessMessage(e){showNotification("success",e)}function showErrorMessage(e){showNotification("error",e)}function showNotification(e,o){var s=$("#notification");s.hasClass("showing")?(s.removeClass("showing"),clearTimeout(notificationTimeout),notificationTimeout=setTimeout(function(){showNotification(e,o)},300)):(s.removeClass(),s.find(".message").html(o),s.addClass(e+" showing"),clearTimeout(notificationTimeout),notificationTimeout=setTimeout(function(){s.removeClass("showing")},1500))}function sendMessage(e,o,s){var a=new WebsocketMessage;a.message=s,a.id=e,a.command=o;var n=JSON.stringify(a);ws.send(n),console.log(n)}function WebsocketMessage(){this.id=-1,this.command="",this.message=""}var ws;$(document).ready(function(){$("#overlay .reload-page").click(function(){location.reload()})});var notificationTimeout