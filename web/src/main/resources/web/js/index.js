var PAGE=1,LAYOUT,MODULES=[];$(document).ready(function(){function t(){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0);$.get("/modules-layout/"+PAGE+"/"+t,function(i){$("#layout").html(i),o(t),e()})}function o(t){$.getJSON("/layout-info/json/"+t,function(t){LAYOUT=t,console.log(LAYOUT),n(),ws===void 0?initWebsocket():sendMessage(-1,"changeLayout",LAYOUT.id)})}function e(){$("#layout .module").each(function(){var t=$(this);i(t.attr("data-module"),t.attr("data-size"))})}function i(t,o){var e=$('#layout .module[data-module="'+t+'"]');$.get("/module-content/"+t+"/"+o,function(t){e.find(".content").html(t)})}function a(){var t=[];$("#layout .module").each(function(){var o=$(this),e=[];e.push(o.attr("data-module")),e.push(o.attr("data-col")),e.push(o.attr("data-row")),e.push(o.attr("data-size")),t.push(e.join(","))});var o={data:t.join("-")};$.post("/save-module-positions/"+LAYOUT.id,o,function(t){console.log(t)})}function n(){u=$(".gridster ul").gridster({widget_margins:[1,1],widget_base_dimensions:[150,150],min_cols:LAYOUT.maxGridWidth,max_cols:LAYOUT.maxGridWidth,draggable:{stop:a}}).data("gridster"),u.recalculate_faux_grid()}var u;t();var l;$(window).resize(function(){clearTimeout(l),l=setTimeout(function(){t()},500)}),$(document).on("click",".gridster .module .module-resize",function(){var t=$(this),o=t.parents(".module").attr("data-module");console.log("Getting available sizes for module "+o),$.getJSON("/module/"+o+"/availableSizes",function(o){console.log(o);var e=[];e.push("<ul><li>"),e.push(o.join("</li><li>")),e.push("</li></ul>"),t.siblings(".module-sizes").html(e.join(""))})}),$(document).on("click",".gridster .module .module-sizes ul li",function(){var t=$(this),o=t.parents(".module"),e=t.html().split("x");console.log(e);var n=e[0],l=e[1];o.attr("data-size",n+"x"+l),u.resize_widget(o,n,l,function(){a(),i(o.attr("data-module"),o.attr("data-size"))})})})