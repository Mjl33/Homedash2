function getSizes(t){var e=t.parents(".module"),o=e.attr("data-module"),i=e.find(".module-sizes");console.log("Getting available sizes for module "+o),$.getJSON("/module/"+o+"/availableSizes",function(t){console.log(t);var e=[];$.each(t,function(t,o){e.push('<li class="resize-size" data-size="',o,'"><a>',o,"</a></li>")}),i.siblings(".resize-size").remove(),i.after(e.join(""))})}function changeSize(t){var e=t.parents(".gridster-item"),o=t.parents(".module"),i=t.attr("data-size").split("x");console.log(i);var a=i[0],n=i[1];o.attr("data-size",a+"x"+n),gridster.resize_widget(e,a,n,function(){savePositions(),getModuleContent(o.attr("data-module"),o.attr("data-size"))})}function getModulesContent(){$("#layout .module").each(function(){var t=$(this);getModuleContent(t.attr("data-module"),t.attr("data-size"))})}function getModuleContent(t,e){var o=$('#layout .module[data-module="'+t+'"]');o.find(".loading").show(),$.get("/module-content/"+t+"/"+e,function(i){o.find(".content").html(i),o.find(".loading").fadeOut("slow"),sendMessage(t,"refresh",e)})}function savePositions(){var t=[];$("#layout .gridster-item").each(function(){var e=$(this),o=[];o.push(e.attr("data-module")),o.push(e.attr("data-col")),o.push(e.attr("data-row")),o.push(e.attr("data-sizex")+"x"+e.attr("data-sizey")),t.push(o.join(","))});var e={data:t.join("-")};$.post("/save-module-positions/"+LAYOUT.id,e,function(t){console.log(t)})}function initGridster(){gridster=$(".gridster").gridster({widget_selector:".gridster-item",widget_margins:[1,1],widget_base_dimensions:[100,100],min_cols:LAYOUT.maxGridWidth,max_cols:LAYOUT.maxGridWidth,draggable:{stop:savePositions,handle:".settings-overlay.drag-box"}}).data("gridster"),gridster.recalculate_faux_grid()}function deleteModule(t){confirm("Delete this module ?")&&$.ajax({url:"/module/"+t,type:"DELETE",success:function(){getLayout()}})}function toggleLayoutEditMode(){$("#layout .gridster").toggleClass("layout-edit")}function rootElement(t){return $('#layout .module[data-module="'+t+'"] .content')}function getLayout(){$("#layout-wrapper .loading").fadeIn("fast");var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0);$.get("/modules-layout/"+PAGE+"/"+t,function(e){$("#layout").html(e),getLayoutInfo(t),$(".gridster-item").each(function(t,e){var e=MODULES[$(this).attr("data-module")];e!=void 0&&e.documentReady!=void 0&&e.documentReady()})}).fail(function(){PAGE=1,typeof Storage!="undefined"&&localStorage.setItem("page",PAGE),getLayout()})}function getLayoutInfo(t){$.getJSON("/layout-info/json/"+t,function(t){LAYOUT=t,console.log(LAYOUT),initGridster(),ws===void 0?initWebsocket():sendMessage(-1,"changeLayout",LAYOUT.id),$("#layout-wrapper .loading").fadeOut("fast"),$("#page-title .layout").html(" ("+LAYOUT.name+")")})}var PAGE=1,LAYOUT,MODULES=[];$(document).ready(function(){if(typeof Storage!="undefined"){var t=localStorage.getItem("page");t!=void 0&&(PAGE=t)}getLayout();var e;$(window).resize(function(){clearTimeout(e),e=setTimeout(function(){getLayout()},500)}),$(document).on("click",".gridster .module .module-settings-icon",function(){var t=$(this);getSizes(t)}),$(document).on("click",".gridster .module .resize-size",function(){var t=$(this);changeSize(t)}),$(document).on("click",".gridster .module  li.delete",function(){var t=$(this);deleteModule(t.attr("data-id"))}),$("#edit-layout").click(function(){$(this).toggleClass("editing"),toggleLayoutEditMode()}),$(document).on("click",".gridster .gridster-item .settings-overlay",function(){$(".gridster .gridster-item.selected").removeClass("selected"),$(".settings-overlay").removeClass("drag-box"),$(this).parents(".gridster-item").addClass("selected"),$(this).addClass("drag-box")}),$("#add-module").click(function(){window.location.href="/add-module/on-page/"+PAGE}),$("#settings-button").click(function(){$(".global-settings").toggleClass("showing")})})