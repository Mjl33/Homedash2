function getSizes(){var t=$("#module-modal").attr("data-id"),e=$("#module-modal").find(".module-sizes");console.log("Getting available sizes for module "+t),$.getJSON("/module/"+t+"/availableSizes",function(t){console.log(t);var o=[];$.each(t,function(t,e){var a=e.split("x")[0];a>LAYOUT.maxGridWidth||e=="full-screen"||o.push('<p class="resize-size" data-size="',e,'"><a>',e,"</a></p>")}),e.siblings(".resize-size").remove(),e.after(o.join(""))})}function changeSize(t,e){var o=$('.gridster .gridster-item[data-module="'+t+'"]'),a=o.find(".module");console.log(e),e=e.split("x");var i=e[0],d=e[1];a.attr("data-size",i+"x"+d),gridster.resize_widget(o,i,d,function(){savePositions(),getModuleContent(a.attr("data-module"),a.attr("data-size")),$("#module-modal").modal("hide")})}function getModulesContent(){$("#layout .module").each(function(){var t=$(this);getModuleContent(t.attr("data-module"),t.attr("data-size"))})}function getModuleContent(t,e){var o=$('#layout .module[data-module="'+t+'"]');o.find(".loading").show(),$.get("/module-content/"+t+"/"+e,function(a){o.find(".content").html(a),o.find(".loading").fadeOut("slow"),sendMessage(t,"refresh",e);var i=MODULES[t];i!=void 0&&i.documentReady!=void 0&&i.documentReady(e),o.find(".content").removeClass(function(t,e){return(e.match(/(^|\s)size-\S+/g)||[]).join(" ")}),o.find(".content").addClass("size-"+e)})}function savePositions(){var t=[];$("#layout .gridster-item").each(function(){var e=$(this),o=[];o.push(e.attr("data-module")),o.push(e.attr("data-col")),o.push(e.attr("data-row")),o.push(e.attr("data-sizex")+"x"+e.attr("data-sizey")),t.push(o.join(","))});var e={data:t.join("-")};$.post("/save-module-positions/"+LAYOUT.id,e,function(t){console.log(t)})}function initGridster(){gridster=$(".gridster").gridster({widget_selector:".gridster-item",widget_margins:[1,1],widget_base_dimensions:[100,100],min_cols:LAYOUT.maxGridWidth,max_cols:LAYOUT.maxGridWidth,draggable:{stop:savePositions,handle:".settings-overlay.drag-box"}}).data("gridster"),gridster.recalculate_faux_grid()}function deleteModule(t){confirm("Delete this module ?")&&$.ajax({url:"/module/"+t,type:"DELETE",success:function(){getLayout(),$("#module-modal").modal("hide")}})}function toggleLayoutEditMode(){$("#layout, #layout-edit-mode").toggleClass("layout-edit"),$(".global-settings").removeClass("showing")}function rootElement(t){return $('#layout .module[data-module="'+t+'"] .content')}function getLayout(){$("#layout-wrapper .loading").fadeIn("fast"),WIDTH=Math.max(document.documentElement.clientWidth,window.innerWidth||0),$.getJSON("/modules-layout/"+PAGE+"/"+WIDTH,function(t){$("#layout").html(t.html),updateLayoutInfo(t.layout),$(".gridster-item").each(function(t,e){var e=MODULES[$(this).attr("data-module")];e!=void 0&&e.documentReady!=void 0&&e.documentReady()})}).fail(function(){PAGE=1,typeof Storage!="undefined"&&localStorage.setItem("page",PAGE),setTimeout(getLayout,500)})}function updateLayoutInfo(t){LAYOUT=t,console.log(LAYOUT),initGridster(),ws===void 0?initWebsocket():sendMessage(-1,"changeLayout",LAYOUT.id),$("#layout-wrapper .loading").fadeOut("fast"),$("#page-title .layout").html(" ("+LAYOUT.name+")")}var PAGE=1,LAYOUT,MODULES=[],WIDTH;$(document).ready(function(){if(typeof Storage!="undefined"){var t=localStorage.getItem("page");t!=void 0&&(PAGE=t)}getLayout();var e;$(window).resize(function(){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0);t!=WIDTH&&(clearTimeout(e),e=setTimeout(function(){getLayout()},500))}),$(document).on("click",".gridster .module .module-settings-icon",function(){$(this);var t=$(this).attr("data-id");$("#module-modal").find("a.edit").attr("href","/module/"+t+"/settings"),$("#module-modal").attr("data-id",t),$("#module-modal").modal("show"),getSizes()}),$(document).on("click","#module-modal .resize-size",function(){var t=$("#module-modal");changeSize(t.attr("data-id"),$(this).attr("data-size"))}),$(document).on("click","#module-modal  p.delete",function(){deleteModule($("#module-modal").attr("data-id"))}),$("#edit-layout, #layout-edit-mode .close-editing").click(function(){toggleLayoutEditMode()}),$(document).on("click",".gridster .gridster-item .settings-overlay",function(){$(".gridster .gridster-item.selected").removeClass("selected"),$(".settings-overlay").removeClass("drag-box"),$(this).parents(".gridster-item").addClass("selected"),$(this).addClass("drag-box")}),$("#add-module").click(function(){window.location.href="/add-module/on-page/"+PAGE}),$("#settings-button").click(function(){$(".global-settings").toggleClass("showing")})})