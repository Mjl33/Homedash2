function rootElement(t){return $('#layout .module[data-module="'+t+'"] .content')}var PAGE=1,LAYOUT,MODULES=[];$(document).ready(function(){function t(t){var e=t.parents(".module"),i=e.attr("data-module"),o=e.find(".module-sizes");console.log("Getting available sizes for module "+i),$.getJSON("/module/"+i+"/availableSizes",function(t){console.log(t);var e=[];$.each(t,function(t,i){e.push('<li class="resize-size" data-size="',i,'"><a>',i,"</a></li>")}),o.siblings(".resize-size").remove(),o.after(e.join(""))})}function e(t){var e=t.parents(".gridster-item"),i=t.parents(".module"),o=t.attr("data-size").split("x");console.log(o);var a=o[0],d=o[1];i.attr("data-size",a+"x"+d),u.resize_widget(e,a,d,function(){s(),n(i.attr("data-module"),i.attr("data-size"))})}function i(){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0);$.get("/modules-layout/"+PAGE+"/"+t,function(e){$("#layout").html(e),o(t),a()})}function o(t){$.getJSON("/layout-info/json/"+t,function(t){LAYOUT=t,console.log(LAYOUT),d(),ws===void 0?initWebsocket():sendMessage(-1,"changeLayout",LAYOUT.id)})}function a(){$("#layout .module").each(function(){var t=$(this);n(t.attr("data-module"),t.attr("data-size"))})}function n(t,e){var i=$('#layout .module[data-module="'+t+'"]');i.find(".loading").show(),$.get("/module-content/"+t+"/"+e,function(t){i.find(".content").html(t),i.find(".loading").fadeOut("slow")})}function s(){var t=[];$("#layout .gridster-item").each(function(){var e=$(this),i=[];i.push(e.attr("data-module")),i.push(e.attr("data-col")),i.push(e.attr("data-row")),i.push(e.attr("data-sizex")+"x"+e.attr("data-sizey")),t.push(i.join(","))});var e={data:t.join("-")};$.post("/save-module-positions/"+LAYOUT.id,e,function(t){console.log(t)})}function d(){u=$(".gridster").gridster({widget_selector:".gridster-item",widget_margins:[1,1],widget_base_dimensions:[100,100],min_cols:LAYOUT.maxGridWidth,max_cols:LAYOUT.maxGridWidth,draggable:{stop:s,handle:".settings-overlay.drag-box"}}).data("gridster"),u.recalculate_faux_grid()}function l(t){confirm("Delete this module ?")&&(window.location.href="/module/"+t+"/delete")}function r(){$("#layout .gridster").toggleClass("layout-edit")}var u;i();var c;$(window).resize(function(){clearTimeout(c),c=setTimeout(function(){i()},500)}),$(document).on("click",".gridster .module .module-settings-icon",function(){var e=$(this);t(e)}),$(document).on("click",".gridster .module .resize-size",function(){var t=$(this);e(t)}),$(document).on("click",".gridster .module  li.delete",function(){var t=$(this);l(t.attr("data-id"))}),$("#edit-layout").click(function(){$(this).toggleClass("editing"),r()}),$(document).on("click",".gridster .gridster-item .settings-overlay",function(){$(".gridster .gridster-item.selected").removeClass("selected"),$(".settings-overlay").removeClass("drag-box"),$(this).parents(".gridster-item").addClass("selected"),$(this).addClass("drag-box")}),$("#settings-button").click(function(){$(".global-settings").toggleClass("showing")})})